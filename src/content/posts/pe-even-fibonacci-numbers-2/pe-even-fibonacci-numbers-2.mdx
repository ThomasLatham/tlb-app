---
title: "Project Euler | Problem #2 | Even Fibonacci Numbers | Post #2"
datePublished: "2025-03-30"
author: Tom Latham
description:
  A neat pattern in the sequence of even Fibonacci numbers, and proving it with the help of the
  result from the previous post in the series.
tags: ["math", "programming"]
---

[//]: # "server imports"

import KaTexComponent from "../components/kaTexComponent";

**Warning:** This post contains spoilers about
[Problem #2: Even Fibonacci Numbers](https://projecteuler.net/problem=2), from
[Project Euler](https://projecteuler.net/)! If you would not like to know my solution, please do not
read on.

# Introduction

In the [previous post in this series](/posts/pe-even-fibonacci-numbers-1), we proved that every
third Fibonacci number is even, and we did so in an attempt to optimize our initial algorithm for
finding the sum of the even Fibonacci numbers less than or equal to $4,000,000$. While interesting
and providing an outlet to practice with mathematical induction, the result of our proof didn't
actually supply any aid in devising a faster function.

In this post, we'll examine a different pattern I noticed not too long after realizing the seeming
futility of the one I just mentioned above. This new formula I thought was particularly cool, not
only because it led to a more efficient algorithm, but also because the way I proved it ended up
relying on the previously-thought-useless pattern I had just proved before.

# Problem Statement

Even though I linked to the problem in the spoiler-alert above and also stated the following in this
series' first post, for the sake of thoroughness and ease of reference, I'll again provide this
problem's description from Project Euler:

**Even Fibonacci Numbers:**

_Each new term in the Fibonacci sequence is generated by adding the previous two terms. By starting
with $\textit 1$ and $\textit 2$, the first terms will be:_

<KaTexComponent
  texExpression="\textit{1, 2, 3, 5, 8, 13, 21, 34, 55, 89, ...}"
  options={{ displayMode: true }}
/>

_By considering the terms in the Fibonacci sequence whose values do not exceed four million, find
the sum of the even-valued terms._

# A New Pattern, a New Hope

As stated in the previous post, in the aftermath of realizing that my first proof had been for
naught (or so I thought), I developed a small fixation on the number $4$ while examining the
sequence of the sums of the even Fibonacci numbers. Each term in the sequence it seemed — at least
those first few that I was examining — was suspiciously close in value to $4$ times the the term
before it. The cognition behind that suspicion didn't fully engage until later on, but still the
focus on $4$ was there, which proved very helpful.

From the sequence of the _sum of the evens_, I turned my attention then to just the sequence of the
evens (the even Fibonacci numbers, that is), writing them out as such:

<KaTexComponent
  texExpression="\mathcal{F_E} = \textit{0, 2, 8, 34, 144, 610, 2584, 10946, ...}"
  options={{ displayMode: true }}
/>

Again noticing that $\mathcal{F_E}(n)$ seemed often close to $4\mathcal{F_E}(n - 1)$, I took to
multiplying each term by 4 and checking the difference between that result and the successive term.
This looked something like,

<KaTexComponent
  texExpression="
    \begin{aligned}
      &0(4) + z = 2 \\
      &2(4) + z = 8 \\
      &8(4) + z = 34 \\
      &34(4) + z = 144 \\
      &144(4) + z = 610 \\
      &\vdots \\
      &\mathcal{F_E}(n)(4) + z = \mathcal{F_E}(n + 1),
    \end{aligned}
  "
  options={{ displayMode: true }}
/>

where $z$ was the difference in which I was interested. It admittedly took me a while to see it, but
filling in the $z$s with the actual differences,

<KaTexComponent
  texExpression="
    \begin{aligned}
      &0(4) + 2 = 2 \\
      &2(4) + 0 = 8 \\
      &8(4) + 2 = 34 \\
      &34(4) + 8 = 144 \\
      &144(4) + 34 = 610, \\
    \end{aligned}
  "
  options={{ displayMode: true }}
/>

something really interesting became apparent. The $z$ value for each line (except the first) was
equal to the value we multiplied by $4$ in the line before it. That is to say, it seemed that $4$
times the current even Fibonacci number plus the previous Fibonacci number gave the next one.
Symbolically, this pattern can be written as:

<KaTexComponent
  texExpression="\mathcal{F_E}(n)(4) + \mathcal{F_E}(n - 1) = \mathcal{F_E}(n + 1)."
  options={{ displayMode: true }}
/>

Shifting the index's perspective around, this is equivalent to conjecturing that the current
Fibonacci number is equal to $4$ times the previous term plus ($1$ times, for clarity) the term
before that, which itself can be written as:

<KaTexComponent
  texExpression="\mathcal{F_E}(n) = 4\mathcal{F_E}(n - 1) + \mathcal{F_E}(n - 2)."
  options={{ displayMode: true }}
/>

This was an awesome find for me! If I could prove this pattern to hold for the entire sequence, then
it meant that I could determine the next even Fibonacci number just by looking at the two evens
before it, and so the resulting algorithm would be more efficient (albeit just by a constant factor)
because it could skip iterating over all the odds as well as checking each term's parity (the state
of being even or odd).

The question remained, though: How do we prove this?

## Proving the Pattern

My first step in attempting to prove the pattern I'd just discovered was to define $\mathcal{F_E}$
in a bit more detail, as a function whose domain is $\mathbb{N}$ (just as we did in the last post
for regular $\mathcal{F}$):

<KaTexComponent
  texExpression="
    \mathcal{F_E}(n) = 
      \begin{cases}
        0& n = 0 \\
        2& n = 1 \\
        4\mathcal{F_E}(n - 1) + \mathcal{F_E}(n - 2)& n \geq 2
      \end{cases}
"
  options={{ displayMode: true }}
/>

Importantly, that last piece in the function definition is what I _thought_ was true about
$\mathcal{F_E}$ — pure conjecture based on a pattern that had only been demonstrated for the first
few terms. The other two pieces of the function are trivially true because they're just enumerating
literally the first two even Fibonacci numbers.

I then wrote down what I _knew_ to be true about $\mathcal{F_E}$. That is, $\mathcal{F_E}$ is the
sequence of even Fibonacci numbers, or equivalently, the sequence of every third Fibonacci number
(because maybe that last bit could come in handy). Now, I didn't want to throw in a "congruence
modulo $2$" into a function definition because it seemed kind of unwieldy in that context, so
instead I notated _what I knew_ as the following:

<KaTexComponent
  texExpression="
    \mathcal{F_E}(n) = 
      \begin{cases}
        0& n = 0 \\
        2& n = 1 \\
        \mathcal{F}(3n)& n \geq 2
      \end{cases}
"
  options={{ displayMode: true }}
/>

And that's when it hit me: My inductive proof from the last post had not been in vain after all! If
I could show that $4\mathcal{F_E}(n - 1) + \mathcal{F_E}(n - 2)$ was equal to $\mathcal{F}(3n)$,
then I would be showing that what I _thought_ to be true was equivalent to what I _knew_ to be true.
In other words, it would prove the pattern. Importantly, the known portion of the proof was in terms
of $\mathcal{F}$, while the conjecture portion was in terms $\mathcal{F_E}$, which I could put into
terms of $\mathcal{F}$ to demonstrate the equivalence. If that doesn't make much sense, hopefully
it'll make more in a bit with the actual proof laid out.

A quick reminder before get into it, recall from the last post that we defined $\mathcal{F}$ to be:

<KaTexComponent
  texExpression="
    \mathcal{F}(n) = 
      \begin{cases}
        n& n \in \lbrace 0, 1 \rbrace \\
        \mathcal{F}(n - 1) + \mathcal{F}(n - 2)& n \geq 2
      \end{cases}
"
  options={{ displayMode: true }}
/>

This will be important to keep in mind for the little game that's to follow. Without further ado,
let's dive in:

<KaTexComponent
  texExpression="
    \begin{aligned}
      \textit{Prove:}\quad  &4\mathcal{F_E}(n - 1) + \mathcal{F_E}(n - 2) = \mathcal{F}(3n).\\
      \\
      &4\mathcal{F_E}(n - 1) + \mathcal{F_E}(n - 2) = 4\mathcal{F}(3(n - 1)) + \mathcal{F}(3(n - 2)) &[\text{definition } \mathcal{F_E}]\\
      =\quad &4\mathcal{F}(3n - 3) + \mathcal{F}(3n - 6)\\
      =\quad &4[\mathcal{F}(3n - 4) + \mathcal{F}(3n - 5)] + \mathcal{F}(3n - 6) &[\text{definition } \mathcal{F}]\\
      =\quad &4\mathcal{F}(3n - 4) + 4\mathcal{F}(3n - 5) + \mathcal{F}(3n - 6)\\
      =\quad &4\mathcal{F}(3n - 4) + 3\mathcal{F}(3n - 5) + [\mathcal{F}(3n - 5) + \mathcal{F}(3n - 6)]\\
      =\quad &4\mathcal{F}(3n - 4) + 3\mathcal{F}(3n - 5) + \mathcal{F}(3n - 4) &[\text{definition } \mathcal{F}]\\
      =\quad &5\mathcal{F}(3n - 4) + 3\mathcal{F}(3n - 5)\\
      =\quad &2\mathcal{F}(3n - 4) + 3[\mathcal{F}(3n - 4) + \mathcal{F}(3n - 5)]\\
      =\quad &2\mathcal{F}(3n - 4) + 3\mathcal{F}(3n - 3) &[\text{definition } \mathcal{F}]\\
      =\quad &2[\mathcal{F}(3n - 3) + \mathcal{F}(3n - 4)] + \mathcal{F}(3n - 3)\\
      =\quad &2\mathcal{F}(3n - 2) + \mathcal{F}(3n - 3) &[\text{definition } \mathcal{F}]\\
      =\quad &[\mathcal{F}(3n - 3) + \mathcal{F}(3n - 2)] + \mathcal{F}(3n - 2)\\
      =\quad &\mathcal{F}(3n - 1) + \mathcal{F}(3n - 2) &[\text{definition } \mathcal{F}]\\
      =\quad &\mathcal{F}(3n) &[\text{definition } \mathcal{F}]\\
      \textit{Q.E.D.}
    \end{aligned}
  "
  options={{ displayMode: true }}
/>

We wanted to make the left-hand side (LHS) of the equality look like the right-hand side (RHS), so
after using the fact that $\mathcal{F_E} = \mathcal{F(3n)}$ to write the LHS in terms of
$\mathcal{F}$, we iteratively used the definition of $\mathcal{F}$ (recalled from the last post) to
work the subtrahends down towards $0$, until we finally arrived at our desired $\mathcal{F(3n)}$.

Anyway, for that pattern which before we only thought might be true, we can now conclude that it
really does hold for all the even Fibonacci numbers. That is, we know the $n^{\text{th}}$ even
Fibonacci number is equal to $4$ times the $(n-1)^{\text{st}}$ plus ($1$ times) the
$(n-2)^{\text{nd}}$, and in knowing this we can finally implement a speedier algorithm than the one
with which we started.

_\*I know that programmatic methods can still succeed without proof of their underlying concepts
(and that as inanimate and abstract objects they are in fact entirely unaware of whether such proof
exists), but what kind of math blog would this be if we didn't prove something now and again?\*_

## A Faster Function, Finally

With this pattern proved, we can fashion for ourselves a new, faster function for finding the sum of
even Fibonaccis[^alliteration-bug]. This time, we won't bother iterating over _all_ of the Fibonacci
numbers, but rather we'll just iterate over the even ones (since that's what the formula we just
proved allows us to do), adding the current $\mathcal{F_E}$ to a running sum as we go. We'll exit
the loop when the current term exceeds the maximum-addend value we pass to the function, and then
finally we'll return the running sum. In TypeScript, this can look like the following (which can
also be seen
[here](https://github.com/ThomasLatham/project-euler/blob/e16b76bfdf4675fec14a6f854a67331ea3236035/src/evenFibonacciNumbers/evenFibonacciNumbers.ts#L52-L64)
in my solution repository):

```TypeScript
/**
 * Sums the even Fibonacci numbers, up to and including the given `maxAddend`.
 *
 * Makes use of the fact that F_e(n) = 4F_e(n - 1) + F_e(n - 2), starting with 0 and 2.
 *
 * @param maxAddend The maximum addend to be added to the sum.
 * @returns The sum of all even Fiboannci numbers less than or equal to the `maxAddend`.
 */
const sumEvenFibonacciNumbersV2 = (maxAddend: number): number => {
  let prev: number = 0;
  let cur: number = 2;
  let sum: number = 0;

  while (cur <= maxAddend) {
    sum += cur;
    const next = cur * 4 + prev;
    prev = cur;
    cur = next;
  }
  return sum;
};
```

Because the loop above only ever sees the even Fibonacci numbers, and because only every third
Fibonacci number is even, we can conclude that `sumEvenFibonacciNumbersV2` is faster than its
predecessor by a constant factor of 3. That might not matter in terms of big-O analysis, but I was
still proud to have improved upon my initial algorithm in this way.

# Conclusion

In this post we found a neat pattern in the sequence of even Fibonacci numbers, and we proved that
it held for the entire sequence using the fact that only every third Fibonacci number is even. Then,
with the finding proven, we optimized our algorithm for finding the sum of the even Fibonaccis.

In the next post in this series, we'll explore a similar pattern in the sequence of the sums of even
Fibonacci numbers. While doing so doesn't offer any advantage towards efficiency, the proof involved
is pretty fun.

[^alliteration-bug]: Sometimes the alliteration bug bites, and there's really nothing you can do.
